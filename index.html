<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Audio Player</title>
    <script src="getfiles.php"></script>
    <style>
        #audio-container {}

        .audio-label {
            margin-left: 1em;
            font-size: 100%;
            font-weight: bold;
        }

        .audio-block {
            align-items: center;
            display: flex;
            margin: 1em;
        }

        .audio-player{
            min-width: 30%;
        }
    </style>
    <script>
        var currentPlayingId = null;
        function playFunc(id) {
            currentPlayingId = id;
            files.forEach(file => {
                if (file != id) {
                    document.getElementById(file).pause();
                }
            });
        }

        function loadFunc(id) {
            console.log("LOADED: ", id);
        }

        function loadAudioFile(file) {
            var label = document.createElement("label");
            label.className = "audio-label";
            label.innerHTML = file;

            var audioBlock = document.createElement("div");
            audioBlock.className = "audio-block";

            var sound = document.createElement('audio');
            sound.id = file;
            sound.className = "audio-player";
            sound.controls = 'controls';
            sound.onplay = () => {
                playFunc(file);
            }
            sound.onended = () => {
                console.log("ENDED");
                document.getElementById(currentPlayingId).play();
                playFunc(currentPlayingId);
            }
            sound.src = `audio/${file}.mp3`;
            sound.type = 'audio/mp3';
            sound.onload = () => {
                console.log("Loaded: ", file);   
            }

            audioBlock.appendChild(sound);
            audioBlock.appendChild(label);
            document.getElementById("audio-container").appendChild(audioBlock);
        }

        function loaded() {
            files.forEach(file => {
                loadAudioFile(file);
                // document.getElementById("audio-container").innerHTML += `
                //     <div class="audio-block">
                //         ${audio}
                //         <label class="audio-label">${file}</label>
                //     </div>
                // `;
                // <audio controls id="${file}" onplay="playFunc('${file}')" canplaythrough="loadFunc('${file}')">
                //             <source src="audio/${file}.mp3" type="audio/mp3">
                //             Your browser does not support the audio element.
                //         </audio>
            });
        }

    </script>
</head>

<body onload="loaded()">
    <div id="audio-container"></div>
</body>

</html>